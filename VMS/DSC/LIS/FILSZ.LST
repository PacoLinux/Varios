FILSZ	X0002 - COMPUTE SIZE OF	MACRO M1110  21-AUG-78 20:51  PAGE 3


      1	000000					$BEGIN	FILSZ,0002,<COMPUTE SIZE OF FILE (ODS-2)>
						.TITLE	FILSZ	X0002 - COMPUTE SIZE OF FILE (ODS-2)
						.IDENT	"X0002"
      2
      3					;
      4					; COPYRIGHT (C) 1976 BY DIGITAL EQUIPMENT CORPORATION,
      5					; MAYNARD, MASSACHUSETTS
      6					;
      7					; THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY ON A
      8					; SINGLE  COMPUTER  SYSTEM AND MAY BE COPIED ONLY WITH THE IN-
      9					; CLUSION OF THE ABOVE COPYRIGHT NOTICE.   THIS  SOFTWARE,  OR
     10					; ANY  OTHER  COPIES THEREOF, MAY NOT BE PROVIDED OR OTHERWISE
     11					; MADE AVAILABLE TO ANY OTHER PERSON EXCEPT FOR  USE  ON  SUCH
     12					; SYSTEM  AND TO ONE WHO AGREES TO THESE LICENSE TERMS.  TITLE
     13					; TO AND OWNERSHIP OF THE SOFTWARE SHALL AT ALL  TIMES  REMAIN
     14					; IN DIGITAL.
     15					;
     16					; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITH-
     17					; OUT  NOTICE  AND  SHOULD NOT BE CONSTRUED AS A COMMITMENT BY
     18					; DIGITAL EQUIPMENT CORPORATION.
     19					;
     20					; DIGITAL EQUIPMENT CORPORATION ASSUMES NO RESPONSIBILITY  FOR
     21					; THE USE OR RELIABILITY OF ITS SOFTWARE ON EQUIPMENT WHICH IS
     22					; NOT SUPPLIED BY DIGITAL.
     23					;
     24					; JOSEPH A. CARCHIDI  8-DEC-77  20:30
     25					; ANDREW C. GOLDSTEIN  11-MAY-78  17:00
     26
     27
     28						.MCALL	FHDL2$
     29	000000					FHDL2$				; DEFINE FILE HEADER LAYOUT
FILSZ	X0002 - COMPUTE SIZE OF	MACRO M1110  21-AUG-78 20:51  PAGE 4


     31					;+
     32					;
     33					; *** - $FILSZ	COMPUTE FILE SIZE
     34					;
     35					; THIS ROUTINE COMPUTES THE SIZE IN LOGICAL BLOCKS OF THE FILE
     36					; WHOSE HEADER IS IN THE INDICATED BUFFER.
     37					;
     38					; INPUTS:
     39					;
     40					;	R5 = HEADER ADDRESS
     41					;
     42					; OUTPUTS:
     43					;
     44					;	R0, R1 = HIGH AND LOW ORDER FILE SIZE
     45					;	OTHER REGISTERS PRESERVED
     46					;
     47					;-
     48
     49	000000				$FILSZ::
     50	000000					PUSH	R2,R3,R4,R5		; SAVE CALLER'S REGS.
     51	000010	005046 				CLR	-(SP)			; MAP WORDS IN USE COUNT TO
     52	000012	156516 	000072 			BISB	H.USE(R5),(SP)		; LOOP COUNTER.
     53	000016	005002 				CLR	R2
     54	000020	156502 	000001 			BISB	H.MPOF(R5),R2		; MAP AREA WORD OFFSET TO R2.
     55	000024	006302 				ASL	R2			; CONVERT TO A BYTE OFFSET.
     56	000026	060205 				ADD	R2,R5			; POINT R5 AT MAP AREA.
     57	000030	005046 				CLR	-(SP)			; INITIALIZE HIGH AND
     58	000032	005046 				CLR	-(SP)			; LOW ORDER FILE SIZE.
     59	000034					WHILE	4(SP)  GT  #0		; LOOP FOR ALL POINTERS.
     60	000042	004767 	000000G			  CALL  $GT1RP			; GET 1 RETRIEVAL POINTER.
     61	000046	062701 	000001 			  ADD  #1,R1			; ADJUST TO REAL BLOCK COUNT.
     62	000052	005500 				  ADC  R0
     63	000054	060116 				  ADD  R1,(SP)			; ACCUMULATE FILE SIZE.
     64	000056	005566 	000002 			  ADC  2(SP)
     65	000062	060066 	000002 			  ADD  R0,2(SP)
     66	000066	160466 	000004 			  SUB  R4,4(SP)			; DECR BY POINTER SIZE.
     67	000072					END	<WHILE LOOP>
     68	000074					POP	R1,R0			; FILE SIZE TO R0,R1.
     69	000100	005226 				INC	(SP)+			; DISCARD LOOP COUNTER.
     70	000102					POP	R5,R4,R3,R2		;RESTORE CALLER'S REGS.
     71	000112					RETURN
     72
     73
     74
     75		000001 				.END
FILSZ	X0002 - COMPUTE SIZE OF	MACRO M1110  21-AUG-78 20:51  PAGE 4-1
SYMBOL TABLE

B0      000034R  	H.FOWN= 000074   	H.SMMX= 000110   	L0      000074R  	$FILSZ  000000RG
E0      000074R  	H.FPRO= 000100   	H.UCHA= 000064   	SC.BAD= 000100   	$GT1RP= ****** GX
FP.DEL= 000010   	H.FRVN= 000014   	H.UFAT= 000024   	SC.DIR= 000040   	$I$   = 000001
FP.EXE= 000004   	H.FSEG= 000004   	H.USE = 000072   	SC.MDL= 000200   	$L    = 000001
FP.RDV= 000001   	H.FSEQ= 000012   	IIII  = 177777   	S.HDHD= 000114   	$L$   = 000000
FP.WRV= 000002   	H.IDOF= 000000   	I.BKDT= 000052   	S.IDHD= 000202   	$O$   = 000000
H.ACOF= 000002   	H.MPOF= 000001   	I.CRDT= 000022   	S.MPHD= 000000   	$R    = 177777
H.CKSM= 000776   	H.PRIV= 000073   	I.EXDT= 000042   	TYPS0 = 000000   	$SUPMC= 000043
H.EFNU= 000016   	H.PROG= 000074   	I.FNAM= 000000   	TYPS1 = 000001   	$T    = 000001
H.EFSQ= 000020   	H.PROJ= 000076   	I.RVDT= 000032   	UC.CON= 000200   	$T1   = 000001
H.ERVN= 000022   	H.RPRO= 000102   	I.RVNO= 000020   	UC.DLK= 000100   	$T2   = 000000
H.FCHA= 000064   	H.RSOF= 000003   	I.ULAB= 000062   	$DIDDO= 000000   	$$T   = 000000
H.FLEV= 000006   	H.SCHA= 000065   	LBLS0 = 000000   	$EF$  = 000000   	...GBL= 000000
H.FNUM= 000010   	H.SEMK= 000104   	LBLS1 = 000000   	$E$   = 000001   	...TPC= 000000

. ABS.	000000	   000
      	000114	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  12724 WORDS  ( 50 PAGES)
DYNAMIC MEMORY:  14388 WORDS  ( 55 PAGES)
ELAPSED TIME:  00:00:24
EXE$:FILSZ,LIS$:FILSZ/-SP=SRC$:SMAC/PA:1,DSCPRE,FILSZ
