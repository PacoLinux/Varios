TRDSU	X0004 - READ VOLUME SUM	MACRO M1110  21-AUG-78 21:21  PAGE 3


      1	000000					$BEGIN	TRDSU,0004,<READ VOLUME SUMMARY FOM TAPE>
						.TITLE	TRDSU	X0004 - READ VOLUME SUMMARY FOM TAPE
						.IDENT	"X0004"
      2
      3					;
      4					; COPYRIGHT (C) 1976 BY DIGITAL EQUIPMENT CORPORATION,
      5					; MAYNARD, MASSACHUSETTS
      6					;
      7					; THIS SOFTWARE IS FURNISHED UNDER A LICENSE FOR USE ONLY ON A
      8					; SINGLE  COMPUTER  SYSTEM AND MAY BE COPIED ONLY WITH THE IN-
      9					; CLUSION OF THE ABOVE COPYRIGHT NOTICE.   THIS  SOFTWARE,  OR
     10					; ANY  OTHER  COPIES THEREOF, MAY NOT BE PROVIDED OR OTHERWISE
     11					; MADE AVAILABLE TO ANY OTHER PERSON EXCEPT FOR  USE  ON  SUCH
     12					; SYSTEM  AND TO ONE WHO AGREES TO THESE LICENSE TERMS.  TITLE
     13					; TO AND OWNERSHIP OF THE SOFTWARE SHALL AT ALL  TIMES  REMAIN
     14					; IN DIGITAL.
     15					;
     16					; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITH-
     17					; OUT  NOTICE  AND  SHOULD NOT BE CONSTRUED AS A COMMITMENT BY
     18					; DIGITAL EQUIPMENT CORPORATION.
     19					;
     20					; DIGITAL EQUIPMENT CORPORATION ASSUMES NO RESPONSIBILITY  FOR
     21					; THE USE OR RELIABILITY OF ITS SOFTWARE ON EQUIPMENT WHICH IS
     22					; NOT SUPPLIED BY DIGITAL.
     23					;
     24					; ANDREW C. GOLDSTEIN  12-AUG-76  2:07
     25					; GEORGE RITTENBURG  6-APR-77	MODIFIED FOR VFY/CMP DISK TO/FROM TAPE
     26					;  GEORGE RITTENBURG  29-MAR-77   CORRECTION  001
TRDSU	X0004 - READ VOLUME SUM	MACRO M1110  21-AUG-78 21:21  PAGE 4


     28					;+
     29					;
     30					; *** - $TRDSU	READ VOLUME SUMMARY FOM TAPE
     31					;
     32					; THIS ROUTINE READS A VOLUME SUMMARY BLOCK FROM THE INPUT TAPE.
     33					;
     34					; INPUTS:
     35					;
     36					;	INLUN ASSIGNED TO UNIT
     37					;	TAPE POSITIONED BEFORE ATTRIBUTE BLOCK
     38					;
     39					; OUTPUTS:
     40					;
     41					;	ATTRIBUTE BLOCK IN $BUF1
     42					;	SUMMARY BLOCK IN $BUF2
     43					;	BLOCK IDENTITY VERIFIED
     44					;
     45					;-
     46
     47	000000				$TRDSO::
     48	000000					$CALL $TINI		;INITIALIZE O.P. TAPE TO READ SUMMRY
     49	000004				$TRDSU::
     50	000004					LET $B2HD+B.STAT := #0		;RELEASE $BUF2
     51	000010					$CALL $RDWAT <,#S.SIZ+P.SIZ,,,#$B2HD> ; READ SUMMARY
     52	000024					ON.ERROR THEN ERROR ER.RSU
     53	000030					IF P.FLAGS(R5) NE #PF.SUM THEN ERROR ER.ITP
     54	000042					IF #KY.NIP SET.IN $FLAG1
     55	000052						LET R0 := #$OLAB
     56	000056					ELSE
     57	000060						LET R0 := #$ILAB		; POINT TO FILE LABEL
     58	000064					END
     59	000064					LET R5 := R5 + #P.SIZ+S.NAME	; AND FILE NAME IN SUMMARY
     60	000070					THRU R1 := #12.
     61	000074					  IFB (R0)+ NE (R5)+ THEN ERROR ER.ITP ; CHECK THE FILE NAME
     62	000102					END LOOP
     63	000106					IF #KY.TAP OFF.IN $OFLAG THEN GOTO ENDRSU
     64	000120					IF #KY.NIP SET.IN $FLAG1 THEN RETURN
     65	000132					LET R0 := #$OLAB	;POINT TO OUTPUT LABEL
     66	000136					IFB (R0) NE #0		; IF LABEL SPECIFIED
     67	000142						LET R5 := #$B2DAT+S.NAME  ; POINT TO FILE LABEL IN SUMMARY
     68	000146						THRU R1 := #12.
     69	000152						   LET (R5)+ :B= (R0)+    ; STORE O.P. FILENAME
     70	000154						END LOOP
     71	000160					END
     72	000160				ENDRSU:	IF $B2DAT+S.MRG NE #0		; SET MERGE MODE   CORRECTION  001
     73	000166					  LET $OFLAG := $OFLAG SET.BY #KY.MRG ; ACCORDING TO TAPE
     74	000174					ELSE
     75	000176					  LET $OFLAG := $OFLAG OFF.BY #KY.MRG
     76	000204					END
     77	000204					RETURN
     78
     79
     80
     81		000001 				.END
TRDSU	X0004 - READ VOLUME SUM	MACRO M1110  21-AUG-78 21:21  PAGE 4-1
SYMBOL TABLE

A3    = 000001   	KY.TAP= ****** GX	L7      000160R  	$EF$  = 000000   	$SUPMC= 000043
B.STAT= ****** GX	LBLS0 = 000011   	PF.SUM= ****** GX	$E$   = 000001   	$T    = 000012
B0      000074R  	LBLS1 = 000001   	P.FLAG= ****** GX	$FLAG1= ****** GX	$TINI = ****** GX
B1      000152R  	L0      000030R  	P.SIZ = ****** GX	$ILAB = ****** GX	$TRDSO  000000RG
ENDRSU  000160R  	L1      000042R  	S.MRG = ****** GX	$I$   = 000001   	$TRDSU  000004RG
ER.ITP= ****** GX	L10     000176R  	S.NAME= ****** GX	$L    = 000002   	$T1   = 000000
ER.RSU= ****** GX	L11     000204R  	S.SIZ = ****** GX	$L$   = 000000   	$T2   = 000011
E0      000106R  	L2      000060R  	TYPS0 = 000000   	$OFLAG= ****** GX	$Y$   = 000000
E1      000160R  	L3      000064R  	TYPS1 = 000006   	$OLAB = ****** GX	$Z$   = 000000
IIII  = 177777   	L4      000102R  	$B2DAT= ****** GX	$O$   = 000000   	$$T   = 000006
KY.MRG= ****** GX	L5      000120R  	$B2HD = ****** GX	$R    = 177777   	.$T   = 000005
KY.NIP= ****** GX	L6      000132R  	$DIDDO= 000000   	$RDWAT= ****** GX

. ABS.	000000	   000
      	000206	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  11397 WORDS  ( 45 PAGES)
DYNAMIC MEMORY:  12276 WORDS  ( 47 PAGES)
ELAPSED TIME:  00:00:59
EXE$:TRDSU,LIS$:TRDSU/-SP=SRC$:SMAC/PA:1,DSCPRE,TRDSU
