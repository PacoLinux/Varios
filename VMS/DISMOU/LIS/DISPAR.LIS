
; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 1
; Digital Equipment Corporation
;
;	0001	MODULE DISPAR (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'X0004'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! Copyright (c) 1977
;	0009	! Digital Equipment Corporation, Maynard, Massachusetts 01754
;	0010	!
;	0011	! This software is furnished  under a license for use only on a single
;	0012	! computer  system and  may be  copied only with  the inclusion of the
;	0013	! above copyright notice.  This software, or any other copies thereof,
;	0014	! may not be provided or  otherwise made available to any other person
;	0015	! except for use on such system and to one who agrees to these license
;	0016	! terms.  Title to and  ownership of the  software  shall at all times
;	0017	! remain in DEC.
;	0018	!
;	0019	! The information in this software is subject to change without notice
;	0020	! and should  not be construed  as a commitment  by Digital  Equipment
;	0021	! Corporation.
;	0022	!
;	0023	! DEC assumes  no  responsibility  for  the use or  reliability of its
;	0024	! software on equipment which is not supplied by DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  MOUNT Utility Structure Level 1
;	0029	!
;	0030	! ABSTRACT:
;	0031	!
;	0032	!	This module contains the data base and utilities used to acquire the
;	0033	!	DISMOUNT command line from the CLI parser.
;	0034	!
;	0035	! ENVIRONMENT:
;	0036	!
;	0037	!	STARLET operating system, including privileged system services
;	0038	!	and internal exec routines.
;	0039	!
;	0040	!--
;	0041	!
;	0042	!
;	0043	! AUTHOR:  Andrew C. Goldstein,	 CREATION DATE:  24-Oct-1977  10:45
;	0044	!
;	0045	! REVISION HISTORY:
;	0046	!
;	0047	!   D. H. Gillespie, 5-Dec-1977  17:26
;	0048	!   X0002 - PUT DEVMAX IN MOUDEF.B32
;	0049	!
;	0050	!   Andrew C. Goldstein, 2-May-78  18:58
;	0051	!   X0003 - Add explicit absolute address bit in $CLIREQDESC calls
;	0052	!
;	0053	!   Andrew C. Goldstein, 16-May-78  16:14
;	0054	!   X0004 - Add /UNLOAD qualifier
;	0055	!

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 1-1
; Digital Equipment Corporation
;
;	0056	!**
;	0057	
;	0058	
;	0059	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0060	REQUIRE 'SRCD$:[MOUNT.SRC]MOUDEF.B32';
;	0367	REQUIRE 'LIBD$:[VMSLIB.OBJ]MOUNTMSG.B32';
;	0467	LIBRARY 'SYS$LIBRARY:CLIMAC.L32';
;	0468	LIBRARY 'SYS$LIBRARY:TPAMAC.L32';

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 2
; Digital Equipment Corporation
;
;	0469	!+
;	0470	!
;	0471	! Impure data area. This area contains the DISMOUNT parameters extracted from
;	0472	! the command line by the associated parsing routines.
;	0473	!
;	0474	!-
;	0475	
;	0476	
;	0477	GLOBAL
;	0478		DISM_OPTIONS	: BITVECTOR [32], ! option flags
;	0479		DEVICE_COUNT,			! number of devices specified
;	0480		DEVICE_STRING	: VECTOR [DEVMAX*2], ! descriptors of device name strings
;	0481	
;	0482		PARSE_IMP_END	: VECTOR [0];	! end of data area
;	0483	
;	0484	LITERAL
;	0485		PARSE_IMP_LEN	= PARSE_IMP_END - DISM_OPTIONS;
;	0486	
;	0487	
;	0488	!
;	0489	! Assorted impure data.
;	0490	!
;	0491	
;	0492	OWN
;	0493		CLI_WORK_AREA	: BBLOCK [CLI$K_WORKAREA];

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 3
; Digital Equipment Corporation
;
;	0494	!+
;	0495	!
;	0496	! Request descriptors to the CLI parser. Labels are deemed sufficiently
;	0497	! obvious to make cluttering the code with comments unnecessary.
;	0498	!
;	0499	!-
;	0500	
;	0501	FORWARD ROUTINE
;	0502		PARSE_ERROR	: NOVALUE,
;	0503		DEVICE_ACT	: NOVALUE;
;	0504	
;	0505	$CLIQUALCODES (DISMOU,
;     P 0506		UNLOAD
;     P 0507		);
;	0508	
;	0509	OWN
;	0510		INIT_PARSE	: $CLIREQDESC (RQTYPE = INITPRS,
;     P 0511					RQFLGS = ABSADR,
;     P 0512					ERRACT = PARSE_ERROR
;     P 0513				),
;	0514		END_PARAM1	: $CLIREQDESC (RQTYPE = ENDPRM1,
;     P 0515					RQFLGS = ABSADR,
;     P 0516					ERRACT = PARSE_ERROR
;     P 0517				),
;	0518		GET_DEVICE	: $CLIREQDESC (RQTYPE = INPUT1,
;     P 0519					RQFLGS = (ABSADR, PARMREQ),
;     P 0520					BITNUM = OPT_DEVICE,
;     P 0521					PRSACT = DEVICE_ACT,
;     P 0522					ERRACT = PARSE_ERROR
;     P 0523				),
;	0524		UNLOAD_Q	: $CLIQUALDESC (
;     P 0525					QDCODE = UNLOAD,
;     P 0526					SETLST = OPT_UNLOAD
;     P 0527				),
;	0528		QUAL_END	: $CLIQUALEND,
;	0529	
;	0530		GET_QUAL	: $CLIREQDESC (RQTYPE = GETQUAL,
;     P 0531					QUALST = UNLOAD_Q,
;     P 0532					RQFLGS = ABSADR,
;     P 0533					ERRACT = PARSE_ERROR
;     P 0534				);

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 4
; Digital Equipment Corporation
;
;	0535	GLOBAL ROUTINE DISMOUNT_PARSE (CLI_CALLBACK) : NOVALUE =
;	0536	
;	0537	!++
;	0538	!
;	0539	! FUNCTIONAL DESCRIPTION:
;	0540	!
;	0541	!	This routine parses the DISMOUNT command line by calling the CLI
;	0542	!	result parse routines, and leaves the results in the global data
;	0543	!	area.
;	0544	!
;	0545	!
;	0546	! CALLING SEQUENCE:
;	0547	!	DISMOUNT_PARSE (ARG1)
;	0548	!
;	0549	! INPUT PARAMETERS:
;	0550	!	ARG1: address of CLI service routine
;	0551	!
;	0552	! IMPLICIT INPUTS:
;	0553	!	NONE
;	0554	!
;	0555	! OUTPUT PARAMETERS:
;	0556	!	NONE
;	0557	!
;	0558	! IMPLICIT OUTPUTS:
;	0559	!	parser impure area on preceding pages
;	0560	!
;	0561	! ROUTINE VALUE:
;	0562	!	NONE
;	0563	!
;	0564	! SIDE EFFECTS:
;	0565	!	NONE
;	0566	!
;	0567	!--
;	0568	
;	0569	BEGIN
;	0570	
;	0571	
;	0572	! Initialize result parsing.
;	0573	!
;	0574	
;	0575	DISM_OPTIONS = 0;
;	0576	
;	0577	(.CLI_CALLBACK) (INIT_PARSE, CLI_WORK_AREA);
;	0578	
;	0579	! Parse command qualifiers.
;	0580	!
;	0581	
;	0582	(.CLI_CALLBACK) (GET_QUAL, CLI_WORK_AREA, DISM_OPTIONS);
;	0583	
;	0584	! Now acquire device names.
;	0585	!
;	0586	
;	0587	DO (.CLI_CALLBACK) (GET_DEVICE, CLI_WORK_AREA, DISM_OPTIONS)
;	0588	WHILE .GET_DEVICE[CLI$V_CONCATINP];
;	0589	

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 4-1
; Digital Equipment Corporation
;
;	0590	(.CLI_CALLBACK) (END_PARAM1, CLI_WORK_AREA);
;	0591	
;	0592	END;					! end of routine DISMOUNT_PARSE


							    .TITLE  DISPAR
							    .IDENT  \X0004\

							    .PSECT  $OWN$,NOEXE,2

					      00000 CLI_WORK_AREA:
							    .BLKB   128
					      00080 INIT_PARSE:
							    .BYTE   0							      ;
					      00081 	    .BYTE   0							      ;
					      00082 	    .BYTE   2							      ;
					      00083 	    .BYTE   0							      ;
					      00084 	    .ADDRESS  PARSE_ERROR					      ;
					      00088 	    .LONG   0, 0						      ;
					      00090 	    .LONG   0							      ;
					      00094 	    .LONG   0							      ;
					      00098 	    .LONG   0							      ;
					      0009C END_PARAM1:
							    .BYTE   48							      ;
					      0009D 	    .BYTE   0							      ;
					      0009E 	    .BYTE   2							      ;
					      0009F 	    .BYTE   0							      ;
					      000A0 	    .ADDRESS  PARSE_ERROR					      ;
					      000A4 	    .LONG   0, 0						      ;
					      000AC 	    .LONG   0							      ;
					      000B0 	    .LONG   0							      ;
					      000B4 	    .LONG   0							      ;
					      000B8 GET_DEVICE:
							    .BYTE   16							      ;
					      000B9 	    .BYTE   30							      ;
					      000BA 	    .BYTE   3							      ;
					      000BB 	    .BYTE   0							      ;
					      000BC 	    .ADDRESS  PARSE_ERROR					      ;
					      000C0 	    .LONG   0, 0						      ;
					      000C8 	    .ADDRESS  DEVICE_ACT					      ;
					      000CC 	    .LONG   0							      ;
					      000D0 	    .LONG   0							      ;
					      000D4 UNLOAD_Q:
							    .BYTE   24							      ;
					      000D5 	    .BYTE    CLI$K_DISM_UNLO					      ;
					      000D6 	    .BYTE   0							      ;
					      000D7 	    .BYTE   0							      ;
					      000D8 	    .LONG   0, 0						      ;
					      000E0 	    .LONG   0							      ;
					      000E4 	    .LONG   0							      ;
					      000E8 	    .BYTE   0							      ;
					      000E9 	    .BYTE   1, 1						      ;
					      000EB 	    .BYTE   0							      ;
					      000EC QUAL_END:
							    .BYTE   0							      ;

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 4-2
; Digital Equipment Corporation
;
					      000ED	    .BLKB   3
					      000F0 GET_QUAL:
							    .BYTE   2							      ;
					      000F1 	    .BYTE   0							      ;
					      000F2 	    .BYTE   2							      ;
					      000F3 	    .BYTE   0							      ;
					      000F4 	    .ADDRESS  PARSE_ERROR					      ;
					      000F8 	    .LONG   0, 0						      ;
					      00100 	    .LONG   0							      ;
					      00104 	    .LONG   0							      ;
					      00108 	    .ADDRESS  UNLOAD_Q						      ;

							    .PSECT  $GLOBAL$,NOEXE,2

					      00000 DISM_OPTIONS::
							    .BLKB   4
					      00004 DEVICE_COUNT::
							    .BLKB   4
					      00008 DEVICE_STRING::
							    .BLKB   128
					      00088 PARSE_IMP_END::
							    .BLKB   0

							    .GLOBL  CLI$K_DISM_UNLO

							    .PSECT  $CODE$,NOWRT,2

					 0C00 00000 	    .ENTRY  DISMOUNT_PARSE, Save R10,R11			      ; 0535
		         5A	0000'  CF  9E 00002 	    MOVAB   DISM_OPTIONS, R10					      ;
		         5B	0000'  CF  9E 00007 	    MOVAB   CLI_WORK_AREA, R11					      ;
				       6A  D4 0000C 	    CLRL    DISM_OPTIONS					      ; 0575
				       5B  DD 0000E 	    PUSHL   R11							      ; 0577
				0080   CB  9F 00010 	    PUSHAB  INIT_PARSE						      ;
		    04   BC	       02  FB 00014 	    CALLS   #2, @CLI_CALLBACK					      ;
				       5A  DD 00018 	    PUSHL   R10							      ; 0582
				       5B  DD 0001A 	    PUSHL   R11							      ;
				00F0   CB  9F 0001C 	    PUSHAB  GET_QUAL						      ;
		    04   BC	       03  FB 00020 	    CALLS   #3, @CLI_CALLBACK					      ;
				       5A  DD 00024 1$:     PUSHL   R10							      ; 0587
				       5B  DD 00026 	    PUSHL   R11							      ;
				00B8   CB  9F 00028 	    PUSHAB  GET_DEVICE						      ;
		    04   BC	       03  FB 0002C 	    CALLS   #3, @CLI_CALLBACK					      ;
	   EE	  00BB   CB	       01  E0 00030 	    BBS     #1, GET_DEVICE+3, 1$				      ; 0588
				       5B  DD 00036 	    PUSHL   R11							      ; 0590
				009C   CB  9F 00038 	    PUSHAB  END_PARAM1						      ;
		    04   BC	       02  FB 0003C 	    CALLS   #2, @CLI_CALLBACK					      ;
					   04 00040 	    RET     							      ; 0535

; Routine Size:  65 bytes



; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 5
; Digital Equipment Corporation
;
;	0593	!+
;	0594	!
;	0595	! Parameter and qualifier action routines. Each routine is named corresponding
;	0596	! to its associated parameter of qualifier. Each routine does whatever
;	0597	! conversion is necessary and stores the parameter or qualifier value in
;	0598	! the appropriate location in the output area.
;	0599	!
;	0600	!-
;	0601	
;	0602	
;	0603	!
;	0604	! CLI error action routine. This routine is called on all CLI errors.
;	0605	! It simply signalls the error back to main level.
;	0606	!
;	0607	ROUTINE PARSE_ERROR (REQ_DESC, ERROR_CODE) : NOVALUE =
;	0608	BEGIN
;	0609	
;	0610	MAP
;	0611		REQ_DESC	: REF BBLOCK;
;	0612	
;	0613	SIGNAL_STOP (.ERROR_CODE);
;	0614	
;	0615	END;					! end of routine PARSE_ERROR





					 0000 00041 PARSE_ERROR:
							    .WORD   Save nothing					      ; 0607
				  08   AC  DD 00043 	    PUSHL   ERROR_CODE						      ; 0613
	      00000000G  00	       01  FB 00046 	    CALLS   #1, LIB$STOP					      ;
					   04 0004D 	    RET     							      ; 0607

; Routine Size:  13 bytes



; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 6
; Digital Equipment Corporation
;
;	0616	!
;	0617	! Get device name
;	0618	!
;	0619	ROUTINE DEVICE_ACT (REQ_DESC, CLI_CALLBACK) : NOVALUE =
;	0620	BEGIN
;	0621	
;	0622	MAP
;	0623		REQ_DESC	: REF BBLOCK;
;	0624	
;	0625	! Clear the parameter required bit for succeeding calls. Count the device
;	0626	! and enter the name descriptor into the device list.
;	0627	!
;	0628	
;	0629	REQ_DESC[CLI$V_PARMREQ] = 0;
;	0630	
;	0631	IF .DEVICE_COUNT GEQ DEVMAX THEN ERR_EXIT (DISM$_MAXDEV);
;	0632	DEVICE_STRING[.DEVICE_COUNT*2] = .REQ_DESC[CLI$W_RQSIZE];
;	0633	DEVICE_STRING[.DEVICE_COUNT*2+1] = .REQ_DESC[CLI$A_RQADDR];
;	0634	DEVICE_COUNT = .DEVICE_COUNT + 1;
;	0635	
;	0636	END;					! end of routine DEVICE_ACT





					 0804 0004E DEVICE_ACT:
							    .WORD   Save R2,R11						      ; 0619
		         5B	0000'  CF  9E 00050 	    MOVAB   DEVICE_COUNT, R11					      ;
		         52	  04   AC  D0 00055 	    MOVL    REQ_DESC, R2					      ; 0629
		    02   A2	       01  8A 00059 	    BICB2   #1, 2(R2)						      ;
		         10	       6B  D1 0005D 	    CMPL    DEVICE_COUNT, #16					      ; 0631
				       0D  19 00060 	    BLSS    1$							      ;
			    0073800C   8F  DD 00062 	    PUSHL   #7569420						      ;
	      00000000G  00	       01  FB 00068 	    CALLS   #1, LIB$STOP					      ;
	   50	         6B	       01  78 0006F 1$:     ASHL    #1, DEVICE_COUNT, R0				      ; 0632
		    04 AB40	  08   A2  3C 00073 	    MOVZWL  8(R2), DEVICE_STRING[R0]				      ;
		    08 AB40	  0C   A2  D0 00079 	    MOVL    12(R2), DEVICE_STRING+4[R0]				      ; 0633
				       6B  D6 0007F 	    INCL    DEVICE_COUNT					      ; 0634
					   04 00081 	    RET     							      ; 0619

; Routine Size:  52 bytes


;	0637	
;	0638	END
;	0639	ELUDOM




							    .GLOBL  LIB$STOP

;				       PSECT SUMMARY
;

; Bliss-32 7.352	Saturday 22-AUG-1978 00:16:10	DBB3:[DISMOU.SRC]DISPAR.B32;11					Page 6-1
; Digital Equipment Corporation
;
;	Name		 Bytes			       Attributes
;
;  $GLOBAL$       	   136    WRT,  RD ,NOEXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)
;  $OWN$          	   268    WRT,  RD ,NOEXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)
;  $CODE$         	   130  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582        15         0       231
;  DBA4:[SYSLIB]CLIMAC.L32;1		        14        14       100        14
;  DBA4:[SYSLIB]TPAMAC.L32;1		        39         0         0         4





; Size:		130 code + 404 data bytes
; Run Time:	00:15.3
; Elapsed Time:	00:40.0
; Memory Used:	287 pages
; Compilation Complete
