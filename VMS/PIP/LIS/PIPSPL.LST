PIPSPL M0212, SPOOL COMMAND-PIP	MACRO M1110  22-AUG-78 01:36
TABLE OF CONTENTS

     7-    1	**** PIPSPL VERSION M0212 ****
PIPSPL M0212, SPOOL COMMAND-PIP	MACRO M1110  22-AUG-78 01:36  PAGE 7


      1						.TITLE	PIPSPL M0212, SPOOL COMMAND-PIP
						.SBTTL	**** PIPSPL VERSION M0212 ****
						.IDENT	/M0212/
      2					; ALTERED:
      3					; ANDREW C. GOLDSTEIN  24 JUL 76  16:53
      4					; B. L. SCHREIBER	23-JUN-77
      5					;
      6					; B. SCHREIBER	27-AUG-77
      7					;
      8					;	BLS025 -- ADD EXIT WITH STATUS
      9					;
     10					; B. SCHREIBER	7-JUN-78
     11					;
     12					;	BLS052 -- INTEGRATE ODS-2 CHANGES FROM A. GOLDSTEIN AND E.
     13					;		MARISON.
     14					;
     15					; COPYRIGHT (C) 1978, DIGITAL EQUIPMENT CORP., MAYNARD, MASS.
     16					; COPYRIGHT (C) 1977, DIGITAL EQUIPMENT CORP., MAYNARD, MASS. 01754
     17					; COPYRIGHT 1975, DIGITAL EQUIPMENT CORP., MAYNARD MASS.
     18					; COPYRIGHT 1974, DIGITAL EQUIPMENT CORP., MAYNARD MASS.
     19
     20					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
     21					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
     22					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
     23					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     24
     25					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
     26					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
     27					; EQUIPMENT CORPORATION.
     28
     29					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY
     30					; OF ITS SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
     31					;
     32					; PETER H. LIPMAN	2-MAY-74
     33
     34						.IF	GT,R$$11M
     35						.MACRO	OPEN$	A1,A2,A3,A4,A5,A6,A7,A8,A9
     36						.MCALL	OFNB$
     37						OFNB$	A1,A2,A3,A4,A5,A6,A7,A8,A9
     38						.ENDM	OPEN$
     39						.ENDC
     40					;
     41						.MCALL	FDOF$L,FCSBT$
     42	000000					FDOF$L			;DEFINE THE FDB OFFSETS LOCALLY
     43	000000					FCSBT$			;DEFINE THE FDB BITS AND VALUES LOCALLY
     44					;
     45						.MCALL	CALL,RETURN,FDRC$R
     46						.MCALL	OPEN$R,PRINT$,CLOSE$
     47
     48	000000					PURE.I
     49
     50					; SPOOL THE SPECIFIED LIST OF FILES FOR PRINTING AND DELETE THEM
     51	000000				SPOOL::	CALL	FSTOUT
     52	000004					FDRC$R	#FDBOUT,#FD.RWM
     53	000016	052767 	000000G	000000G	SPOOL1:	BIS	#FRSTIM,CPYCTL
     54						.IF	LE,R$$11M
     55						BIT	#FIDBIT,CPYCTL	; CHECK FOR /FI SWITCH
PIPSPL M0212, SPOOL COMMAND-PIP	MACRO M1110  22-AUG-78 01:36  PAGE 7-1
**** PIPSPL VERSION M0212 ****

     56						BEQ	2$
     57						JMP	80$
     58					2$:
     59						.ENDC
     60	000024					CALL	PARSE
     61	000030	103002 				BCC	5$		; IF CC OK
     62	000032	000167 	000304 			JMP	60$		; ELSE ERROR
     63	000036				5$:
     64	000036	016067 	000120 	000000G		MOV	F.FVER(R0),VERSAV
     65	000044				10$:										;BLS052
     66						.IF NDF	O$$DS2								;BLS052
     67						MOV	VERSAV,F.FVER(R0)						;BLS052
     68						.ENDC									;BLS052
     69	000044					CALL	FNDNXT								;**-1
     70	000050	103537 				BCS	68$
     71	000052	042767 	000000G	000000G		BIC	#FRSTIM,CPYCTL
     72	000060	016701 	000000G			MOV	SPLCNT,R1	; GET COPY COUNT
     73	000064	001403 				BEQ	14$
     74	000066	020127 	000144 			CMP	R1,#100.	; CHECK AGAINST LIMIT
     75	000072	101402 				BLOS	15$		; OK
     76	000074	012701 	000001 		14$:	MOV	#1,R1		; DEFAULT TO 1
     77
     78	000100	016046 	000102 		15$:	MOV	F.FNB(R0),-(SP)	;SAVE THE FILE ID SINCE PRINT$ WIPES IT
     79	000104					OPEN$R	R0		;OPEN THE FILE
     80	000116	103517 				BCS	70$
     81					; SPOOL THE OPEN FILE FOR PRINTING, SPOOLER WILL CLOSE, PRINT AND
     82					; DELETE THE FILE
     83	000120					PRINT$	R0
     84	000310	012660 	000102 			MOV	(SP)+,F.FNB(R0)	;RESTORE FILE ID FOR NEXT COPY
     85	000314	103431 				BCS	75$
     86	000316	005301 				DEC	R1		; SEE IF DONE ENOUGH
     87	000320	001402 				BEQ	20$		; IF EQ YES
     88	000322	000167 	177552 			JMP	15$		; NO--DO MORE (JMP SINCE PRINT$ IS BIG)
     89	000326				20$:	CLOSE$	R0		;CERTAIN CONDITIONS WILL LEAVE IT OPEN
     90	000332					CALL	NXTFIL		;ANY MORE FILES IN THIS FILE SPEC?
     91	000336	103425 				BCS	SPLNXT		;BRANCH IF NO
     92	000340	000641 				BR	10$		;GO FIND THE NEXT FILE
     93					;
     94					; PARSE ERROR
     95	000342				60$:	CALL	PRSERR
     96	000346	000421 				BR	SPLNXT
     97					;
     98					; FAILED TO FIND FILE
     99	000350				68$:	CALL	FNDERR
    100	000354	000416 				BR	SPLNXT
    101					;
    102					; OPEN FAILURE
    103	000356	005726 			70$:	TST	(SP)+		;CLEAN THE STACK
    104	000360					ERROUT	OP01,0,0
	000360	104426 				TRAP	X
	000362	000000G				.WORD	OP01SZ
	000364	000000G				.WORD	OP01MG
    105	000366	012700 	000000G			MOV	#FDBOUT,R0
    106	000372					CALL	SETWAR		;SET WARNING STATUS
    107	000376	000753 				BR	20$
    108					;
    109					; ERROR FROM PRINT$
PIPSPL M0212, SPOOL COMMAND-PIP	MACRO M1110  22-AUG-78 01:36  PAGE 7-2
**** PIPSPL VERSION M0212 ****

    110	000400				75$:	ERROUT	SP01,0
	000400	104406 				TRAP	X
	000402	000000G				.WORD	SP01SZ
	000404	000000G				.WORD	SP01MG
    111	000406					CALL	SETWAR		;SET WARNING STATUS
    112						.IF	LE,R$$11M
    113						BR	SPLNXT
    114					;
    115					; ATTEMPT TO SPOOL FILE BY FILE ID - NOT SUPPORTED
    116					80$:	ERROUT	SP02
    117						.ENDC
    118					;
    119					; GO GET THE NEXT FILE IN THE LIST TO BE SPOOLED
    120	000412				SPLNXT:	CALL	NXTOUT
    121	000416	103402 				BCS	10$
    122	000420	000167 	177372 			JMP	SPOOL1
    123	000424	000167 	000000G		10$:	JMP	CLOSX
    124
    125					;
    126					;
    127		000001 				.END
PIPSPL M0212, SPOOL COMMAND-PIP	MACRO M1110  22-AUG-78 01:36  PAGE 7-3
SYMBOL TABLE

AB.CDT  000105   	FD.FTN= 000001   	F.BGBC= 000057   	F.SEQN= 000100   	OP01SZ= ****** GX
AB.CHU  000064   	FD.F11= 040000   	F.BKDN= 000026   	F.SPDV= 000072   	O$$DS2= 000001
AB.EXP  000122   	FD.INS= 000010   	F.BKDS= 000020   	F.SPUN= 000074   	PARSE = ****** GX
AB.FNU  000000   	FD.ISP= 002000   	F.BKEF= 000050   	F.STBK= 000036   	PAR$$$= 000000
AB.FP   000062   	FD.MNT= 100000   	F.BKP1= 000051   	F.UNIT= 000136   	PRSERR= ****** GX
AB.FSQ  000002   	FD.OSP= 004000   	F.BKST= 000024   	F.URBD= 000020   	R$$DPB= 000001
AB.GC   000061   	FD.PLC= 000004   	F.BKVB= 000064   	F.VBN = 000064   	R$$DYM= 000001
AB.NAM  000006   	FD.PRN= 000004   	F.CHR = 000075   	F.VBSZ= 000060   	R$$EIS= 000000
AB.PC   000060   	FD.PSE= 010000   	F.CNTG= 000034   	G.LUCW= 000004   	R$$VMS= 000001
AB.RDT  000070   	FD.RAH= 000001   	F.DFNB= 000046   	G.LUFB= 000003   	R$$11M= 000001
AB.REV  000066   	FD.RAN= 000002   	F.DSPT= 000044   	G.LUNA= 000000   	R.FIX = 000001
AB.UAT  000020   	FD.REC= 000001   	F.DVNM= 000134   	G.LUNU= 000002   	R.SEQ = 000003
CH.AND= 000001   	FD.RWM= 000001   	F.EFBK= 000010   	NB.DEV= 000200   	R.VAR = 000002
CLOSX = ****** GX	FD.SDI= 000020   	F.EFN = 000050   	NB.DIR= 000100   	SETWAR= ****** GX
CPYCTL= ****** GX	FD.SQD= 000040   	F.EOBB= 000032   	NB.NAM= 000004   	SPLCNT= ****** GX
FA.APD= 000100   	FD.TTY= 000004   	F.ERR = 000052   	NB.NXD= 020000   	SPLNXT  000412R     002
FA.CRE= 000010   	FD.WBH= 000002   	F.FACC= 000043   	NB.SD1= 000400   	SPOOL   000000RG    002
FA.DLK= 001000   	FF.CHR= 000005   	F.FFBY= 000014   	NB.SD2= 001000   	SPOOL1  000016R     002
FA.ENB= 100000   	FF.NV = 000003   	F.FNAM= 000110   	NB.SNM= 000040   	SP01MG= ****** GX
FA.EXC= 002000   	FF.POE= 000002   	F.FNB = 000102   	NB.STP= 000020   	SP01SZ= ****** GX
FA.EXT= 000004   	FF.RWD= 000001   	F.FTYP= 000116   	NB.SVR= 000010   	S.FATT= 000016
FA.NSP= 000100   	FF.RWF= 000006   	F.FVER= 000120   	NB.TYP= 000002   	S.FDB = 000140
FA.POS= 010000   	FF.SPC= 000004   	F.HIBK= 000004   	NB.VER= 000001   	S.FNAM= 000006
FA.RD = 000001   	FNDERR= ****** GX	F.LUN = 000042   	NB.WLV= 010000   	S.FNB = 000036
FA.RWD= 004000   	FNDNXT= ****** GX	F.MBCT= 000054   	NXTFIL= ****** GX	S.FNBW= 000017
FA.SEQ= 040000   	FO.APD= 000106   	F.MBC1= 000055   	NXTOUT= ****** GX	S.FNTY= 000004
FA.SHR= 000040   	FO.MFY= 000002   	F.MBFG= 000056   	N.DID = 000024   	S.FTYP= 000002
FA.TMP= 000020   	FO.RD = 000001   	F.NRBD= 000024   	N.DVNM= 000032   	S.NFEN= 000020
FA.WCK= 020000   	FO.UPD= 000006   	F.NREC= 000030   	N.FID = 000000   	VERSAV= ****** GX
FA.WRT= 000002   	FO.WRT= 000016   	F.OVBS= 000030   	N.FNAM= 000006   	X     = 000006
FDBOUT= ****** GX	FRSTIM= ****** GX	F.RACC= 000016   	N.FTYP= 000014   	$DSPAT= ****** GX
FD.BLK= 000010   	FSTOUT= ****** GX	F.RATT= 000001   	N.FVER= 000016   	$$$OST= 000014
FD.CCL= 000002   	F.ACTL= 000076   	F.RCNM= 000034   	N.NEXT= 000022   	.CLOSE= ****** G
FD.COM= 020000   	F.ALOC= 000040   	F.RCTL= 000017   	N.STAT= 000020   	.OPFNB= ****** G
FD.CR = 000002   	F.BBFS= 000062   	F.RSIZ= 000002   	N.UNIT= 000034   	...GBL= 000000
FD.DIR= 000010   	F.BDB = 000070   	F.RTYP= 000000   	OP01MG= ****** GX	...TPC= 000140

. ABS.	000131	   000
      	000000	   001
PURE$I	000430	   002
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  5607 WORDS  ( 22 PAGES)
DYNAMIC MEMORY:  6996 WORDS  ( 26 PAGES)
ELAPSED TIME:  00:00:23
OBJ$:PIPSPL,LIS$:PIPSPL/-SP=SRC$:PIPMAC,PIPSPL
