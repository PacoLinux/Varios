PIPSB1 M0212, COMMAND SUBROUTIN	MACRO M1110  22-AUG-78 01:36
TABLE OF CONTENTS

     7-    1	**** PIPSB1 VERSION M0212 ****
PIPSB1 M0212, COMMAND SUBROUTIN	MACRO M1110  22-AUG-78 01:36  PAGE 7


      1						.TITLE	PIPSB1 M0212, COMMAND SUBROUTINES - PIP
						.SBTTL	**** PIPSB1 VERSION M0212 ****
						.IDENT	/M0212/
      2					; ALTERED THURSDAY 9-JAN-75 9:25
      3					;
      4					; B. SCHREIBER	27-AUG-77
      5					;
      6					;	BLS025 -- ADD EXIT WITH STATUS
      7					;
      8					; B. SCHREIBER	7-JUN-78
      9					;
     10					;	BLS052 -- INTEGRATE ODS-2 CHANGES FROM A. GOLDSTEIN AND E.
     11					;		MARISON.
     12					;
     13					; COPYRIGHT (C) 1978, DIGITAL EQUIPMENT CORP., MAYNARD, MASS.
     14					; COPYRIGHT (C) 1977, DIGITAL EQUIPMENT CORP., MAYNARD, MASS.
     15					; COPYRIGHT 1974, DIGITAL EQUIPMENT CORP., MAYNARD MASS.
     16
     17					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
     18					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
     19					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
     20					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     21
     22					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
     23					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
     24					; EQUIPMENT CORPORATION.
     25
     26					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY
     27					; OF ITS SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
     28					;
     29					; PETER H. LIPMAN	9-JAN-75
     30
     31	000000					FLDSOF
     32						.MCALL	CALL,RETURN
     33
     34	000000					IMPURE									;BLS052
     35															;BLS052
     36	000000	   377 	   002 		RDOWN:	.BYTE	-1,2		;ATTRIBUTE LIST TO READ				;BLS052
     37	000002	000000G				.WORD	.FOWNR		;DIRECTORY OWNERSHIP				;BLS052
     38	000004	000000 				.WORD	0								;BLS052
     39															;BLS052
     40	000006					PURE.I
     41
     42					;
     43					; WRITE ATTRIBUTES
     44					; INPUTS:
     45					;	R0=FDB ADDRESS
     46					;	R1=ADDRESS OF ATTRIBUTE BLOCK
     47					;.HDRAD CONTAINS THE ADDRESS OF THE ATTRIBUTE BUFFER				;BLS052
     48					; OUTPUTS:
     49					;	C=0 IF OK, C=1 IF ERROR
     50	000000	010146 			WRTATT::MOV	R1,-(SP)	;ADDRESS OF ATTRIBUTE BLOCK
     51	000002	010046 				MOV	R0,-(SP)
     52	000004	062716 	000000G			ADD	#F.FNB,@SP
     53					;
     54					; NOW CALL XQIO
     55	000010	010603 				MOV	SP,R3		;ADDRESS OF ADDITIONAL PARAMETERS
PIPSB1 M0212, COMMAND SUBROUTIN	MACRO M1110  22-AUG-78 01:36  PAGE 7-1
**** PIPSB1 VERSION M0212 ****

     56	000012	012702 	000002 			MOV	#2,R2		;SIZE OF EXTRA PARAM BLOCK
     57	000016	012701 	000000G			MOV	#IO.WAT,R1	;I/O FUNCTION CODE  - WRT ATTRIBUTES
     58	000022					CALL	.XQIO
     59	000026	012603 				MOV	(SP)+,R3	;CLEAN UP THE STACK
     60	000030	012603 				MOV	(SP)+,R3
     61	000032	103006 				BCC	10$		;BRANCH IF ERROR, MUST POP 5 WORDS
     62	000034					ERROUT	UN01,0,0
	000034	104426 				TRAP	X
	000036	000000G				.WORD	UN01SZ
	000040	000000G				.WORD	UN01MG
     63	000042					CALL	SETWAR		;MAKE IT WARNING
     64	000046	000261 				SEC
     65	000050				10$:	RETURN
     66					;
     67					; READ ATTRIBUTES - JUST THE FILE HEADER
     68					; INPUTS:
     69					;	R0=FDB
     70					;	R1=FNB ADDRESS
     71					; OUTPUTS:
     72					;	C=0 IF SUCCESSFUL, C=1 IF ERROR
     73					;	R0,R1,R4,R5 PRESERVED, R2,R3 ALTERED
     74					;
     75	000052				RDATT::
     76						.IF	EQ,R$$DPB	;IF OLD DPB FORMAT
     77						MOV	#HDBLK,-(SP)	;FILE HEADER ADDRESS
     78						.IFF			;IF NEW DPB FORMAT
     79	000052	012746 	000004G			MOV	#RATCTL+4,-(SP) ;ADDRESS OF ATTRIBUTE CONTROL BLOCK
     80						.ENDC
     81
     82	000056	010146 				MOV	R1,-(SP)	;ADDRESS OF FILE NAME BLOCK
     83						.IF DF	O$$DS2								;BLS052
     84					;										;BLS052
     85					; SET UP READ ATTRIBUTES CONTROL LIST						;BLS052
     86					;										;BLS052
     87	000060	016703 	000000G			MOV	.HDRAD,R3	; GET BASE ADDRESS OF ATTR BUFFER		;BLS052
     88	000064	062703 	000020 			ADD	#AB.UAT,R3	;BUFFER ADDRESS OF RECORD ATTRIBUTES		;BLS052
     89	000070	010367 	000000G			MOV	R3,.UAT								;BLS052
     90	000074	062703 	000040 			ADD	#AB.PC-AB.UAT,R3 ;BUFFER ADDRESS OF UIC				;BLS052
     91	000100	010367 	000000G			MOV	R3,.UIC								;BLS052
     92	000104	062703 	000006 			ADD	#AB.REV-AB.PC,R3 ;BUFFER ADDRESS OF DATES			;BLS052
     93	000110	010367 	000000G			MOV	R3,.REV								;BLS052
     94					;										;BLS052
     95					; END OF ATTRIBUTE SETUP							;BLS052
     96					;										;BLS052
     97						.ENDC									;BLS052
     98	000114	010603 				MOV	SP,R3		;R3=ADDRESS OF EXTRA PARAMETERS
     99	000116	012702 	000002 			MOV	#2,R2		;R2=NO. OF EXTRA PARAMETERS
    100	000122	012701 	000000G			MOV	#IO.RAT,R1	;READ ATTRIBUTES I/O FUCNTION CODE
    101	000126					CALL	.XQIO		;ISSUE THE QI/O AND WAIT
    102	000132	012601 				MOV	(SP)+,R1	;CLEAN UP STACK, PRESERVIN C BIT
    103	000134	012602 				MOV	(SP)+,R2
    104	000136					RETURN
    105					;
    106					;+
    107					;
    108					; ** .GFOWN - SET UP FILE OWNER WORD IF /FO WAS SPECIFIED
    109					;
PIPSB1 M0212, COMMAND SUBROUTIN	MACRO M1110  22-AUG-78 01:36  PAGE 7-2
**** PIPSB1 VERSION M0212 ****

    110					; INPUTS:
    111					;
    112					;	R0=FDB
    113					;
    114					; OUTPUTS:
    115					;
    116					;	R0,R5 PRESERVED, OTHERS ALTERED
    117					;	.FOWNR=UIC OF DIRECTORY FOR THIS FDB IF /FO SWITCH WAS SPECIFIED
    118					;	.FOWNR=0 IF /FO NOT SPECIFIED OR IF FDB IS NOT FOR A DIRECTORY DEVICE
    119					;
    120					;-
    121	000140				.GFOWN::
    122						.IF DF	O$$DS2								;BLS052
    123	000140	012746 	000000'			MOV	#RDOWN,-(SP)	;ADDRESS OF ATTRIBUTE LIST			;BLS052
    124	000144	010046 				MOV	R0,-(SP)	;FDB						;BLS052
    125	000146	062716 	000000C			ADD	#F.FNB+N.DID,(SP) ;ADDRESS OF DIRECTORY ID			;BLS052
    126						.IFF									;BLS052
    127						MOV	#.FOWNR,R3
    128						.IFTF									;BLS052
    129	000152	032767 	000000G	000000G		BIT	#FOWNBT,CPYCTL	;WAS /FO SPECIFIED?
    130	000160	001414 				BEQ	20$		;BRANCH IF NO, JUST RETURN 0
    131	000162	132760 	000000G	000000G		BITB	#FD.DIR,F.RCTL(R0) ;IS THIS A DIRECTORY DEVICE?
    132	000170	001410 				BEQ	20$		;BRANCH IF NO
    133						.IFT									;BLS052
    134	000172	010603 				MOV	SP,R3		;R3 = PARAMETER LIST				;BLS052
    135	000174	012702 	000002 			MOV	#2,R2		;R2 = PARAMETER COUNT				;BLS052
    136	000200	012701 	000000G			MOV	#IO.RAT,R1	;R1 = FUNCTION CODE				;BLS052
    137	000204					CALL	.XQIO		;READ OWNERSHIP OF DIRECTORY FILE		;BLS052
    138	000210	103002 				BCC	30$		;BRANCH IF CONVERSION OK			;BLS052
    139	000212	005067 	000000G		20$:	CLR	.FOWNR		;SAY NO FILE OWNER SPECIFIED			;BLS052
    140	000216	022626 			30$:	CMP	(SP)+,(SP)+	;CLEAN THE STACK				;BLS052
    141	000220					RETURN									;BLS052
    142						.IFF									;BLS052
    143						MOV	F.DSPT(R0),R2	;R2=DESCRIPTOR POINTER
    144						ADD	#N.DIRD,R2	;FORM ADDRESS OF DIRECTORY STRING DESCRIPTOR
    145						MOV	(R2),-(SP)	;SAVE SIZE OF STRING
    146						BNE	10$		;BRANCH IF NOT NULL
    147						MOV	R2,R4		;SAVE ADDRESS
    148						CALL	.RDFDR		;READ THE DEFAULT DIRECTORY STRING
    149						MOV	R1,(R4)		;STORE IT'S SIZE
    150						MOV	R2,2(R4)	;AND ADDRESS
    151						MOV	R4,R2		;R2 = DIRECTORY STRING DESCRIPTOR
    152					10$:	CALL	.ASCPP		;CONVERT TO PPN - STORE (R3)
    153						MOV	(SP)+,(R2)	;RESTORE ORIGINAL SIZE OF STRING OR 0
    154						BCC	30$		;BRANCH IF CONVERSION OK
    155					20$:	CLR	(R3)		;SAY NO FILE OWNER SPECIFIED
    156					30$:	RETURN
    157						.ENDC									;BLS052
    158					;
    159					;
    160		000001 				.END
PIPSB1 M0212, COMMAND SUBROUTIN	MACRO M1110  22-AUG-78 01:36  PAGE 7-3
SYMBOL TABLE

AB.CDT  000105   	AB.REV  000066   	NB.WLV= 010000   	RDOWN   000000R     002	UN01SZ= ****** GX
AB.CHU  000064   	AB.UAT  000020   	N.DEVD= 000000   	R$$DPB= 000001   	WRTATT  000000RG    003
AB.EXP  000122   	CPYCTL= ****** GX	N.DID = ****** GX	R$$DYM= 000001   	X     = 000026
AB.FNU  000000   	FD.DIR= ****** GX	N.DIRD= 000004   	R$$EIS= 000000   	.FOWNR= ****** GX
AB.FP   000062   	FOWNBT= ****** GX	N.FLID= 000016   	R$$VMS= 000001   	.GFOWN  000140RG    003
AB.FSQ  000002   	F.FNB = ****** GX	N.FNMD= 000010   	R$$11M= 000001   	.HDRAD= ****** GX
AB.GC   000061   	F.RCTL= ****** GX	N.SPEC= 000014   	SETWAR= ****** GX	.REV  = ****** GX
AB.NAM  000006   	IO.RAT= ****** GX	O$$DS2= 000001   	S.APPD= 000010   	.UAT  = ****** GX
AB.PC   000060   	IO.WAT= ****** GX	RATCTL= ****** GX	S.FIDS= 000014   	.UIC  = ****** GX
AB.RDT  000070   	NB.NXD= 020000   	RDATT   000052RG    003	UN01MG= ****** GX	.XQIO = ****** GX

. ABS.	000131	   000
      	000000	   001
IMPURE	000006	   002
PURE$I	000222	   003
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  2644 WORDS  ( 11 PAGES)
DYNAMIC MEMORY:  3828 WORDS  ( 14 PAGES)
ELAPSED TIME:  00:00:12
OBJ$:PIPSB1,LIS$:PIPSB1/-SP=SRC$:PIPMAC,PIPSB1
